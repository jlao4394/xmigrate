#!/usr/bin/env node
parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"injection.tokens.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core");exports.LoggerConfig=new e.InjectionToken("logger-config"),exports.Config=new e.InjectionToken("migrations-config"),exports.CommandInjector=new e.InjectionToken("CommandInjector");
},{}],"helpers/log-factory.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,r,o){var s,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var g=e.length-1;g>=0;g--)(s=e[g])&&(n=(i<3?s(n):i>3?s(t,r,n):s(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},r=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},o=this&&this.__param||function(e,t){return function(r,o){t(r,o,e)}};Object.defineProperty(exports,"__esModule",{value:!0});const s=require("@rxdi/core"),i=require("../injection.tokens"),n=require("fs");class g{constructor(e,t){this.successLogger=n.createWriteStream(e,{flags:"a"}),this.errorLogger=n.createWriteStream(t,{flags:"a"})}log(e){this.successLogger.write(this.getLogTemplate(e,"üöÄ"))}error(e){this.errorLogger.write(this.getLogTemplate(e,"üî•"))}getLogTemplate(e,t){return`\n${t} ********* ${new Date} *********\n\n${JSON.stringify(e,null,2)}\n`}}let c=class{constructor(e){this.config=e,this.loggers=new Map}getDownLogger(){return this.create("down",this.getConfig("down"))}getUpLogger(){return this.create("up",this.getConfig("up"))}getConfig(e){return{successPath:`${this.config.folder}/${this.config[e].success}`,errorPath:`${this.config.folder}/${this.config[e].error}`}}create(e,{successPath:t,errorPath:r}){return this.has(e)?this.get(e):(this.loggers.set(e,new g(t,r)),this.get(e))}has(e){return this.loggers.has(e)}get(e){return this.loggers.get(e)}};c=t([s.Injectable(),o(0,s.Inject(i.LoggerConfig)),r("design:paramtypes",["function"==typeof(e=void 0!==i.LoggerConfig&&i.LoggerConfig)?e:Object])],c),exports.LogFactory=c;
},{"../injection.tokens":"injection.tokens.ts"}],"services/config/config.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,i,o){var n,c=arguments.length,r=c<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var f=e.length-1;f>=0;f--)(n=e[f])&&(r=(c<3?n(r):c>3?n(t,i,r):n(t,i))||r);return c>3&&r&&Object.defineProperty(t,i,r),r},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});const o=require("@rxdi/core"),n=require("../../injection.tokens");let c=class{constructor(e){this.initConfig=e,this.config={}}set(e){this.config=Object.assign(e,this.initConfig)}get(){return this.config}};c=t([o.Injectable(),i("design:paramtypes",["function"==typeof(e=void 0!==n.Config&&n.Config)?e:Object])],c),exports.ConfigService=c;
},{"../../injection.tokens":"injection.tokens.ts"}],"services/generic-runner/generic-runner.service.ts":[function(require,module,exports) {
"use strict";var e,t,o=this&&this.__decorate||function(e,t,o,n){var r,i=arguments.length,a=i<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,o,n);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,o,a):r(t,o))||a);return i>3&&a&&Object.defineProperty(t,o,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},r=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function a(e){try{s(n.next(e))}catch(t){i(t)}}function l(e){try{s(n.throw(e))}catch(t){i(t)}}function s(e){e.done?r(e.value):new o(function(t){t(e.value)}).then(a,l)}s((n=n.apply(e,t||[])).next())})},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const a=require("path"),l=i(require("chalk")),s=require("../../helpers/log-factory"),c=require("@rxdi/core"),u=require("../config/config.service");let d=class{constructor(e,t){this.logger=e,this.configService=t,this.tasks=new Map}setTasks(e){this.tasks=new Map(e)}run(e,t){return r(this,void 0,void 0,function*(){if(yield this.logEnvironment(e),!this.tasks.has(e))throw new Error("\nüî•  Missing command");try{const n=yield this.tasks.get(e)(t);n&&n.status&&n.result.length?console.log(`\n          \nüî•  There are ${l.default.red(n.result.length)} migration with status '${l.default.red("PENDING")}' run '${l.default.green("xmigrate up")}' command!\n          `):console.log(`\n        \nüöÄ  ${l.default.green.bold(n&&n.length?`Success! Runned ${n.length} migrations.`:"Already up to date")}\n        `),process.exit(0)}catch(o){console.error(`\n      \nüî•  ${l.default.bold("Status: Operation executed with error")}\nüß®  ${l.default.bold("Error: "+JSON.stringify(o))}\nüì®  ${l.default.bold("Message: "+o.message)}\n      `),t&&t.fallback&&(yield this.fallback(o.fileName),process.exit(0)),process.exit(1)}})}fallback(e){return r(this,void 0,void 0,function*(){const t={fileName:e},o=this.logger.getDownLogger();try{const{migrationsDir:r}=this.configService.config,i=a.normalize(`${process.cwd()}/${r}/${e}`);console.log(`\n\nüôè  ${l.default.bold("Status: Executing fallback operation")} ${l.default.red("xmigrate down")}\nüìÅ  ${l.default.bold("Migration:")} ${i}\n        `),t.appliedAt=new Date,t.result=yield require(i).down(),console.log(`\nüöÄ  ${l.default.green("Fallback operation success, nothing changed if written correctly!")}`),o.log(t)}catch(n){console.log("\nüî•  Migration fallback exited with error  ",n),o.error({errorMessage:n.message,fileName:e}),process.exit(1)}return t})}bind(e){return Array.from(this.tasks.keys()).map(t=>this.tasks.set(t,this.tasks.get(t).bind(e))),this}logEnvironment(e){return r(this,void 0,void 0,function*(){const{mongodb:{databaseName:t},migrationsDir:o,logger:{folder:n},changelogCollectionName:r}=this.configService.config;console.log(`\n    \nüñ•Ô∏è  ${l.default.bold("Database:")} ${l.default.blue.bold(t)}\n    \nüíø  ${l.default.bold("DBCollection:")} ${l.default.blue.bold(r)}\n    \nüóÑÔ∏è  ${l.default.bold("LoggerDir:")} ${l.default.blue.bold(n)}\n    \nüìÅ  ${l.default.bold("MigrationsDir:")} ${l.default.blue.bold(o)}\n    \nüë∑  ${l.default.bold("Script:")} ${l.default.blue.bold(`xmigrate ${e}`)}\n    `)})}};d=o([c.Injectable(),n("design:paramtypes",["function"==typeof(e=void 0!==s.LogFactory&&s.LogFactory)?e:Object,"function"==typeof(t=void 0!==u.ConfigService&&u.ConfigService)?t:Object])],d),exports.GenericRunner=d;
},{"../../helpers/log-factory":"helpers/log-factory.ts","../config/config.service":"services/config/config.service.ts"}],"services/database/database.service.ts":[function(require,module,exports) {
"use strict";var e,t=this&&this.__decorate||function(e,t,o,n){var i,c=arguments.length,r=c<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,o,n);else for(var f=e.length-1;f>=0;f--)(i=e[f])&&(r=(c<3?i(r):c>3?i(t,o,r):i(t,o))||r);return c>3&&r&&Object.defineProperty(t,o,r),r},o=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},n=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(i,c){function r(e){try{a(n.next(e))}catch(t){c(t)}}function f(e){try{a(n.throw(e))}catch(t){c(t)}}function a(e){e.done?i(e.value):new o(function(t){t(e.value)}).then(r,f)}a((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const i=require("@rxdi/core"),c=require("mongodb"),r=require("mongoose"),f=require("../config/config.service");let a=class{constructor(e){this.configService=e}connect(){return n(this,void 0,void 0,function*(){const e=this.configService.config.mongodb.url,t=this.configService.config.mongodb.databaseName;if(!e)throw new Error("No `url` defined in config file!");if(!t)throw new Error("No `databaseName` defined in config file! This is required since migrate-mongo v3. See https://github.com/seppevs/migrate-mongo#initialize-a-new-project");return(yield c.MongoClient.connect(e,this.configService.config.mongodb.options)).db(t)})}mongooseConnect(e){return r.connect(`${this.configService.config.mongodb.url}/${this.configService.config.mongodb.databaseName}`,e)}};a=t([i.Injectable(),o("design:paramtypes",["function"==typeof(e=void 0!==f.ConfigService&&f.ConfigService)?e:Object])],a),exports.DatabaseService=a;
},{"../config/config.service":"services/config/config.service.ts"}],"helpers/ensure-folder.ts":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function u(t){try{s(n.next(t))}catch(e){o(e)}}function c(t){try{s(n.throw(t))}catch(e){o(e)}}function s(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(u,c)}s((n=n.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const e=require("util"),i=require("fs");function n(n){return t(this,void 0,void 0,function*(){try{yield e.promisify(i.mkdir)(n,{recursive:!0})}catch(t){if("EEXIST"!==t.code)throw t}})}exports.ensureDir=n;
},{}],"helpers/date.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("date-fns");exports.now=((e=Date.now())=>{const t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())}),exports.nowAsString=(()=>e.format(exports.now(),"YYYYMMDDHHmmss"));
},{}],"templates/native.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="\nmodule.exports = {\n  async up (db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: true } })\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 5 } })\n  },\n\n  async down (db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 0 } })\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: false } })\n  }\n}\n";
},{}],"templates/basic.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="\nmodule.exports = {\n  async up () {\n    return ['Up']\n  },\n\n  async down () {\n    return ['Down']\n  }\n}\n";
},{}],"templates/typescript.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default="\nimport { Db } from 'mongodb';\n\nexport = {\n  async up(db: Db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: true } });\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 5 } });\n  },\n\n  async down(db: Db) {\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Doors' }, { $set: { stars: 0 } });\n    await db\n      .collection('albums')\n      .updateOne({ artist: 'The Beatles' }, { $set: { blacklisted: false } });\n  }\n};\n";
},{}],"templates/index.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const t=e(require("./native"));exports.native=t.default;const r=e(require("./basic"));exports.basic=r.default;const s=e(require("./typescript"));exports.typescript=s.default;
},{"./native":"templates/native.ts","./basic":"templates/basic.ts","./typescript":"templates/typescript.ts"}],"services/migrations-resolver/migrations-resolver.service.ts":[function(require,module,exports) {
"use strict";var e,i=this&&this.__decorate||function(e,i,t,r){var n,o=arguments.length,c=o<3?i:null===r?r=Object.getOwnPropertyDescriptor(i,t):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,i,t,r);else for(var f=e.length-1;f>=0;f--)(n=e[f])&&(c=(o<3?n(c):o>3?n(i,t,c):n(i,t))||c);return o>3&&c&&Object.defineProperty(i,t,c),c},t=this&&this.__metadata||function(e,i){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,i)},r=this&&this.__awaiter||function(e,i,t,r){return new(t||(t=Promise))(function(n,o){function c(e){try{s(r.next(e))}catch(i){o(i)}}function f(e){try{s(r.throw(e))}catch(i){o(i)}}function s(e){e.done?n(e.value):new t(function(i){i(e.value)}).then(c,f)}s((r=r.apply(e,i||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),o=require("fs"),c=require("path"),f=require("util"),s=require("../config/config.service");let a=class{constructor(e){this.configService=e}getFileNames(){return r(this,void 0,void 0,function*(){return(yield f.promisify(o.readdir)(this.configService.config.migrationsDir)).filter(e=>".js"===c.extname(e))})}loadMigration(e){return require(c.join(process.cwd(),this.configService.config.migrationsDir,e))}resolve(){return r(this,void 0,void 0,function*(){return c.isAbsolute(this.configService.config.migrationsDir)?this.configService.config.migrationsDir:c.join(process.cwd(),this.configService.config.migrationsDir)})}};a=i([n.Injectable(),t("design:paramtypes",["function"==typeof(e=void 0!==s.ConfigService&&s.ConfigService)?e:Object])],a),exports.MigrationsResolver=a;
},{"../config/config.service":"services/config/config.service.ts"}],"helpers/error.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});class e extends Error{}exports.ErrorMap=e;
},{}],"services/migration/migration.service.ts":[function(require,module,exports) {
"use strict";var e,t,i,r,o=this&&this.__decorate||function(e,t,i,r){var o,n=arguments.length,a=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,r);else for(var l=e.length-1;l>=0;l--)(o=e[l])&&(a=(n<3?o(a):n>3?o(t,i,a):o(t,i))||a);return n>3&&a&&Object.defineProperty(t,i,a),a},n=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__awaiter||function(e,t,i,r){return new(i||(i=Promise))(function(o,n){function a(e){try{s(r.next(e))}catch(t){n(t)}}function l(e){try{s(r.throw(e))}catch(t){n(t)}}function s(e){e.done?o(e.value):new i(function(t){t(e.value)}).then(a,l)}s((r=r.apply(e,t||[])).next())})},l=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const c=require("../database/database.service"),d=require("@rxdi/core"),u=require("../../helpers/ensure-folder"),f=require("util"),g=require("fs"),h=require("../../helpers/date"),p=l(require("../../templates/index")),m=require("../migrations-resolver/migrations-resolver.service"),v=s(require("chalk")),y=require("path"),N=require("../../helpers/log-factory"),b=require("../../helpers/error"),w=require("../config/config.service");let S=class{constructor(e,t,i,r){this.configService=e,this.database=t,this.migrationsResolver=i,this.logger=r}connect(){return a(this,void 0,void 0,function*(){return yield this.ensureFolders(),yield this.database.mongooseConnect(),this.database.connect()})}ensureFolders(){return a(this,void 0,void 0,function*(){yield u.ensureDir(this.configService.config.logger.folder),yield u.ensureDir(this.configService.config.migrationsDir)})}up(){return a(this,void 0,void 0,function*(){const e=(yield this.statusInternal()).filter(e=>"PENDING"===e.appliedAt),t=[],i=yield this.connect(),r=this.logger.getUpLogger(),o=e=>a(this,void 0,void 0,function*(){let o;try{const n=yield this.migrationsResolver.loadMigration(e.fileName);o=yield n.up(i)}catch(c){const i=new b.ErrorMap(c.message);throw i.fileName=e.fileName,i.migrated=t,r.error({migrated:t,errorMessage:i.message,fileName:e.fileName}),i}const n=i.collection(this.configService.config.changelogCollectionName),{fileName:a}=e,l=new Date;try{yield n.insertOne({fileName:a,appliedAt:l})}catch(c){throw r.error({migrated:t,errorMessage:c.message,fileName:e.fileName}),new Error(`Could not update changelog: ${c.message}`)}const s={fileName:e.fileName,appliedAt:l,result:o};return r.log(s),t.push(s),yield!0});for(const n of e)yield o(n);return this.printStatus(t),t})}down(){return a(this,void 0,void 0,function*(){const e=[],t=(yield this.statusInternal()).filter(e=>"PENDING"!==e.appliedAt),i=t[t.length-1];let r;const o=this.logger.getDownLogger(),n=yield this.connect();if(i){try{const t=this.migrationsResolver.loadMigration(i.fileName);r=yield t.down(n)}catch(a){const t=new b.ErrorMap(a.message);throw t.fileName=i.fileName,t.downgraded=e,o.error({downgraded:e,errorMessage:a.message,fileName:i.fileName}),t}const t=n.collection(this.configService.config.changelogCollectionName);try{yield t.deleteOne({fileName:i.fileName});const n={fileName:i.fileName,appliedAt:new Date,result:r};o.log(n),e.push(n)}catch(a){throw o.error({downgraded:e,errorMessage:a.message,fileName:i.fileName}),new Error(`Could not update changelog: ${a.message}`)}}return this.printStatus(e),r})}createWithTemplate(e,t){return a(this,void 0,void 0,function*(){if(!p[e])throw new Error(`üî•  *** Missing template ${e} ***`);const i="typescript"===e,r=y.normalize(`./${this.configService.config.migrationsDir}/${h.nowAsString()}-${t}.${i?"ts":"js"}`);return yield f.promisify(g.writeFile)(r,p[e],{encoding:"utf-8"}),r})}create({name:e,template:t}){return a(this,void 0,void 0,function*(){yield this.ensureFolders();const i=t||this.configService.config.defaultTemplate,r=yield this.createWithTemplate(i,e);console.log(`\n\nüöÄ  ${v.default.bold("Template:")} "${v.default.blue(i)}"!\n\nüíæ  ${v.default.bold("File:")} ${v.default.blue(y.normalize(`${process.cwd()}//${r}`))}\n\nüöÄ  ${v.default.green.bold("Migration template created!")}\n`),process.exit(0)})}statusInternal(){return a(this,void 0,void 0,function*(){const e=yield this.migrationsResolver.getFileNames(),t=(yield this.connect()).collection(this.configService.config.changelogCollectionName),i=yield t.find({}).toArray();return e.map(e=>{const t=i.find(t=>t.fileName===e),r=t?t.appliedAt.toJSON():"PENDING";return{fileName:e,appliedAt:r,result:null}})})}status(){return a(this,void 0,void 0,function*(){const e=yield this.statusInternal();return this.printStatus(e,"table"),{status:!0,result:e.filter(e=>"PENDING"===e.appliedAt)}})}printStatus(e,t){if("table"===t)return console.table(e,["fileName","appliedAt"]);e.forEach((e,t)=>console.log(`\n#Ô∏è‚É£  ${v.default.white.bold(String(t+1))}\n${v.default.blue("-".repeat(process.stdout.columns))}\nüìÅ  ${v.default.bold("Filename:")} ${v.default.green(e.fileName)}\n‚è±Ô∏è  ${v.default.bold("Applied at:")} ${v.default.green(String(e.appliedAt))}\n${v.default.blue("-".repeat(process.stdout.columns))}\n    `))}};S=o([d.Injectable(),n("design:paramtypes",["function"==typeof(e=void 0!==w.ConfigService&&w.ConfigService)?e:Object,"function"==typeof(t=void 0!==c.DatabaseService&&c.DatabaseService)?t:Object,"function"==typeof(i=void 0!==m.MigrationsResolver&&m.MigrationsResolver)?i:Object,"function"==typeof(r=void 0!==N.LogFactory&&N.LogFactory)?r:Object])],S),exports.MigrationService=S;
},{"../database/database.service":"services/database/database.service.ts","../../helpers/ensure-folder":"helpers/ensure-folder.ts","../../helpers/date":"helpers/date.ts","../../templates/index":"templates/index.ts","../migrations-resolver/migrations-resolver.service":"services/migrations-resolver/migrations-resolver.service.ts","../../helpers/log-factory":"helpers/log-factory.ts","../../helpers/error":"helpers/error.ts","../config/config.service":"services/config/config.service.ts"}],"helpers/args-extractors.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.includes=(e=>process.argv.toString().includes(e)),exports.nextOrDefault=((e,r=!0,s=(e=>e))=>{if(process.argv.toString().includes(e)){const t=process.argv[process.argv.indexOf(e)+1];return t?t.includes("--")?r:s(t):r}return r});
},{}],"default.config.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DEFAULT_CONFIG={changelogCollectionName:"migrations",migrationsDir:"migrations",logger:{folder:"./migrations-log",up:{success:"up.success.log",error:"up.error.log"},down:{success:"down.success.log",error:"down.error.log"}},mongodb:{url:"mongodb://localhost:27017",databaseName:"test",options:{useNewUrlParser:!0}},defaultTemplate:"basic"};
},{}],"migrations.module.ts":[function(require,module,exports) {
"use strict";var e,r=this&&this.__decorate||function(e,r,t,n){var o,i=arguments.length,c=i<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,t):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,r,t,n);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(c=(i<3?o(c):i>3?o(r,t,c):o(r,t))||c);return i>3&&c&&Object.defineProperty(r,t,c),c},t=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(o,i){function c(e){try{u(n.next(e))}catch(r){i(r)}}function s(e){try{u(n.throw(e))}catch(r){i(r)}}function u(e){e.done?o(e.value):new t(function(r){r(e.value)}).then(c,s)}u((n=n.apply(e,r||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const n=require("@rxdi/core"),o=require("./services/generic-runner/generic-runner.service"),i=require("./helpers/log-factory"),c=require("./injection.tokens"),s=require("./services/migration/migration.service"),u=require("./helpers/args-extractors"),a=require("./default.config"),l=require("path"),d=require("./services/config/config.service");let f=e=class{static forRoot(r=a.DEFAULT_CONFIG){return{module:e,providers:[o.GenericRunner,i.LogFactory,{provide:c.Config,useValue:r},d.ConfigService,{provide:c.LoggerConfig,useValue:r.logger},{provide:c.LoggerConfig,useValue:r.logger},{provide:"set-tasks",deps:[o.GenericRunner,s.MigrationService],useFactory:(e,r)=>t(this,void 0,void 0,function*(){const t=[["up",r.up],["down",r.down],["status",r.status],["create",r.create]];return e.setTasks(t),e.bind(r),t})},{provide:c.CommandInjector,useFactory:()=>{const[,,...e]=process.argv;return{command:e[0],argv:e}}},{provide:"start",deps:[c.CommandInjector,o.GenericRunner,d.ConfigService],useFactory:({command:e,argv:r},n,o)=>t(this,void 0,void 0,function*(){try{o.set(yield require(l.join(process.cwd(),"./xmigrate.js"))(o))}catch(t){}return"create"===e?n.run(e,{name:r[1],template:u.nextOrDefault("--template",null)}):"up"===e?n.run(e,{fallback:u.includes("--falback")}):n.run(e)})}]}}};f=e=r([n.Module()],f),exports.MigrationsModule=f;
},{"./services/generic-runner/generic-runner.service":"services/generic-runner/generic-runner.service.ts","./helpers/log-factory":"helpers/log-factory.ts","./injection.tokens":"injection.tokens.ts","./services/migration/migration.service":"services/migration/migration.service.ts","./helpers/args-extractors":"helpers/args-extractors.ts","./default.config":"default.config.ts","./services/config/config.service":"services/config/config.service.ts"}],"app.module.ts":[function(require,module,exports) {
"use strict";var e=this&&this.__decorate||function(e,t,r,o){var c,i=arguments.length,l=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(c=e[s])&&(l=(i<3?c(l):i>3?c(t,r,l):c(t,r))||l);return i>3&&l&&Object.defineProperty(t,r,l),l};Object.defineProperty(exports,"__esModule",{value:!0});const t=require("@rxdi/core"),r=require("./migrations.module");let o=class{};o=e([t.Module({imports:[r.MigrationsModule.forRoot()]})],o),exports.AppModule=o;
},{"./migrations.module":"migrations.module.ts"}],"main.ts":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e=require("@rxdi/core"),r=require("./app.module");e.Bootstrap(r.AppModule).subscribe(()=>{},console.error.bind(console));
},{"./app.module":"app.module.ts"}]},{},["main.ts"], null)
//# sourceMappingURL=/main.js.map